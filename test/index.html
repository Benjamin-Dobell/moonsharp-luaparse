<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <title>Spec Unit Tests</title>
  <link rel="stylesheet" href="lib/newton.css">
</head>
<body>
  <div id="suite"></div>
  <script src="lib/spec.js"></script>
  <script src="lib/newton.js"></script>
  <script src="lib/spec_adapter.js"></script>

  <!-- Library -->
  <script>
    (function () {
      var Spec = this.Spec, Newton = this.Newton, parameters;
      if (!Spec || !Newton) {
        return;
      }
      parameters = Newton.parseQuery(this.location.search);
      if (this.location.hash === '#testem') {
        this.document.write('<script src="/testem.js"><\/script>');
      }
      if (Spec.hasKey(parameters, 'amd')) {
        this.document.write('<script src="../components/requirejs/require.js"><\/script>');
      }
    }).call(this);
  </script>
  <script>
    var testSuite = {};
    (function (root) {
      var specs = [
            'spec/assignments'
          , 'spec/comments'
          , 'spec/conditional'
          , 'spec/do'
          , 'spec/escapesequences'
          , 'spec/expressions'
          , 'spec/for'
          , 'spec/stringcalls'
          , 'spec/tablecalls'
          , 'spec/functioncalls'
          , 'spec/functions'
          , 'spec/literals'
          , 'spec/local'
          , 'spec/operators'
          , 'spec/repeat'
          , 'spec/return'
          , 'spec/scope'
          , 'spec/statements'
          , 'spec/tableconstructors'
          , 'spec/while'
        ];

      if (typeof require == 'function' && typeof define == 'function') {
        require({
          // Thwart aggressive resource caching.
          'urlArgs': 'async=' + (+new Date())
        }, ['../luaparse'].concat(specs), function (luaparse) {
          // Remember whether luaparse exposed a global.
          var notExposed = typeof root.luaparse === 'undefined';
          // The runner relies on the global.
          root.luaparse = luaparse;

          require(['runner'], function(testSuite) {
            testSuite.addTest('Asynchronous Module Definition', function (test) {
              setTimeout(function () {
                test.equal(typeof luaparse.parse, 'function', 'Luaparse should be exported as an asynchronous module').done(2);
              }, 1500);
              test.ok(notExposed, 'Luaparse should not expose itself as a global when loaded as a module');
            });
            testSuite.run();
          });
        });
      } else {
        root.document.write('<script src="../luaparse.js"><\/script>');
        Spec.forEach(specs, function(spec) {
          root.document.write('<script src="' + spec + '.js"><\/script>');
        });
        root.document.write('<script src="runner.js"><\/script>');
        root.onload = function () {
          luaparse.testSuite.run();
        };
      }
    }(this));
  </script>
</body>
</html>
