#!/usr/bin/env node
/*jshint node:true*/
/*globals console:true */
'use strict';

var fs = require('fs')
  , luaparse = require('../')
  , snippets = process.argv.splice(2)
  , beautify = false
  , quiet = false;

if (!snippets.length || /^--help|-h/.test(snippets[0])) {
  console.log("Usage:\n\tluaparse [file|snippet]...");
  console.log("\nFlags:\n\t-b|--beautify\n\t-q|--quiet\n\t-h|--help");
  console.log("\nExamples:");
  console.log("\tluaparse \"locale foo  = \\\"bar\\\"");
  console.log("\tluaparse foo.lua");
  process.exit(1);
}

snippets.forEach(function(snippet) {
  if (/^-b|--beautify/.test(snippet)) return beautify = true;
  if (/^-q|--quiet/.test(snippet)) return quiet = true;
  // This is a file, not a code snippet.
  if (fs.existsSync(snippet)) {
    snippet = fs.readFileSync(snippet, 'utf-8');
  }
  var ast = luaparse.parse(snippet);

  if (!quiet) {
    if (beautify) console.log(JSON.stringify(ast, null, '  '));
    else console.log(JSON.stringify(ast));
  }
});

/* vim: set sw=2 ts=2 et tw=80 ft=javascript : */
